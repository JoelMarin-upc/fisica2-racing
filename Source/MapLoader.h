#pragma once

#include "Application.h"
#include "Checkpoint.h"
#include "SlowZone.h"
#include "Finishline.h"
#include "PhysicEntity.h"
#include "Transform2D.h"
#include "Map.h"
#include "Circle.h"
#include "pugixml.hpp"
#include <algorithm>

class MapData {
public:
	MapData() {}
	int width = 0, height = 0;
	std::vector<Checkpoint*> checkpoints;
	std::vector<PhysicEntity*> obstacles;
    std::vector<SlowZone*> slowZones;
    std::vector<Booster*> booster;
	std::vector<std::pair<Transform2D, int>> startPositions;
	Finishline* finishline = nullptr;
};

class MapLoader
{
public:
	static Map* LoadMap(int mapNumber, Application* app, Module* listener) {
        int totalCars = 0;
        std::string carsBasePath = "";
        int* boundsIn = nullptr;
		unsigned int boundsInSize = 0;
        bool boundsInReverse;
		int* boundsOut = nullptr;
		unsigned int boundsOutSize = 0;
        bool boundsOutReverse;
		int* navigationLayerIn = nullptr;
		unsigned int navigationLayerInSize = 0;
        bool navInReverse;
		int* navigationLayerOut = nullptr;
		unsigned int navigationLayerOutSize = 0;
        bool navOutReverse;
		const char* mapImg = nullptr;
		const char* mapTmx = nullptr;
		const char* boxTex = nullptr;
		const char* circleTex = nullptr;
		if (mapNumber == 1)
		{
            int bIn[260] = {
                1722, 1588,
                1722, 1132,
                1702, 1132,
                1702, 1569,
                771, 1569,
                735, 1554,
                685, 1556,
                639, 1572,
                608, 1594,
                566, 1563,
                508, 1532,
                474, 1505,
                444, 1499,
                428, 1473,
                433, 1437,
                424, 1416,
                429, 1396,
                447, 1364,
                445, 1327,
                428, 1308,
                424, 1289,
                440, 1268,
                442, 1234,
                438, 1210,
                421, 1178,
                430, 1133,
                438, 1111,
                422, 1096,
                425, 1078,
                436, 1068,
                433, 1044,
                429, 1030,
                403, 1025,
                384, 1027,
                384, 717,
                394, 708,
                403, 717,
                419, 705,
                430, 631,
                433, 594,
                425, 575,
                429, 564,
                426, 531,
                416, 493,
                403, 468,
                390, 457,
                393, 433,
                1688, 433,
                1688, 415,
                412, 411,
                426, 385,
                453, 334,
                451, 307,
                433, 288,
                419, 274,
                398, 274,
                385, 284,
                371, 298,
                355, 297,
                343, 282,
                330, 264,
                307, 256,
                279, 259,
                264, 278,
                261, 308,
                271, 325,
                273, 343,
                276, 366,
                283, 387,
                274, 404,
                268, 426,
                269, 451,
                279, 488,
                294, 516,
                315, 539,
                315, 564,
                306, 584,
                292, 605,
                270, 621,
                256, 634,
                253, 653,
                262, 677,
                269, 703,
                283, 731,
                296, 749,
                323, 762,
                346, 755,
                372, 723,
                372, 1034,
                362, 1076,
                365, 1092,
                356, 1116,
                357, 1135,
                351, 1157,
                347, 1215,
                346, 1290,
                340, 1329,
                339, 1384,
                339, 1402,
                330, 1452,
                323, 1476,
                323, 1491,
                301, 1521,
                280, 1558,
                268, 1600,
                266, 1650,
                278, 1688,
                298, 1725,
                326, 1757,
                367, 1782,
                403, 1772,
                433, 1756,
                457, 1754,
                484, 1741,
                522, 1733,
                564, 1731,
                599, 1734,
                631, 1743,
                663, 1760,
                694, 1773,
                716, 1774,
                731, 1772,
                753, 1763,
                786, 1736,
                800, 1708,
                805, 1669,
                803, 1632,
                794, 1606,
                801, 1588,
                1704, 1588
            };
            int bOut[186] = {
                19, 40,
                20, 73,
                22, 1843,
                27, 1901,
                59, 1911,
                106, 1960,
                148, 1989,
                179, 2004,
                1870, 2006,
                1902, 1975,
                1928, 1951,
                1943, 1921,
                1949, 1885,
                1981, 1861,
                2006, 1811,
                2030, 1789,
                2030, 1103,
                2012, 1069,
                2008, 1033,
                1989, 1006,
                1998, 969,
                1998, 914,
                1979, 870,
                1960, 823,
                1926, 814,
                1894, 774,
                1879, 731,
                1452, 731,
                1426, 744,
                1425, 1084,
                717, 1084,
                717, 822,
                736, 822,
                736, 1068,
                1405, 1068,
                1408, 740,
                1445, 712,
                1883, 712,
                1902, 667,
                1929, 628,
                1958, 600,
                1990, 581,
                2024, 567,
                2024, 114,
                1978, 90,
                1958, 55,
                1915, 37,
                1879, 17,
                1787, 17,
                1734, 8,
                1705, 20,
                1681, 20,
                1655, 12,
                1591, 13,
                1573, 4,
                1545, 6,
                1523, 17,
                1492, 22,
                1439, 29,
                1389, 22,
                1364, 20,
                1349, 12,
                1236, 10,
                1190, 20,
                1165, 24,
                1137, 10,
                1110, 10,
                1083, 17,
                1052, 13,
                995, 38,
                954, 65,
                884, 77,
                838, 52,
                799, 29,
                742, 19,
                723, 6,
                708, 13,
                678, 12,
                625, 19,
                575, 6,
                494, 27,
                389, 35,
                352, 27,
                276, 28,
                211, 26,
                188, 32,
                160, 28,
                140, 19,
                118, 36,
                93, 37,
                76, 28,
                52, 35,
                26, 35
            };
            int navIn[310] = {
                435, 284,
                1669, 285,
                1709, 311,
                1728, 346,
                1729, 392,
                1705, 426,
                1669, 451,
                1394, 451,
                1335, 463,
                1286, 480,
                1267, 480,
                1222, 511,
                1192, 554,
                1178, 600,
                1174, 666,
                1174, 732,
                1176, 777,
                1188, 801,
                1165, 817,
                1134, 841,
                1106, 849,
                1075, 837,
                1048, 831,
                1023, 820,
                1018, 780,
                1021, 759,
                1046, 748,
                1057, 710,
                1050, 669,
                1034, 643,
                1027, 627,
                1036, 577,
                1025, 539,
                1010, 500,
                1009, 480,
                997, 463,
                966, 457,
                928, 451,
                493, 449,
                467, 472,
                442, 480,
                424, 500,
                428, 553,
                433, 603,
                428, 655,
                415, 718,
                415, 1024,
                434, 1039,
                435, 1069,
                426, 1100,
                436, 1117,
                419, 1176,
                438, 1215,
                440, 1266,
                425, 1294,
                439, 1318,
                445, 1356,
                431, 1396,
                429, 1427,
                434, 1485,
                443, 1501,
                471, 1507,
                525, 1537,
                589, 1576,
                605, 1592,
                634, 1576,
                671, 1556,
                719, 1554,
                750, 1562,
                1580, 1562,
                1620, 1554,
                1645, 1536,
                1664, 1526,
                1677, 1485,
                1672, 1455,
                1659, 1443,
                1658, 1317,
                1670, 1295,
                1673, 1245,
                1677, 1221,
                1668, 1194,
                1651, 1178,
                1656, 1137,
                1651, 1115,
                1638, 1091,
                1635, 1055,
                1652, 1027,
                1686, 1015,
                1727, 1014,
                1754, 1027,
                1764, 1051,
                1761, 1091,
                1747, 1126,
                1761, 1160,
                1760, 1340,
                1750, 1375,
                1761, 1421,
                1761, 1635,
                1751, 1682,
                1731, 1720,
                1695, 1748,
                1646, 1766,
                1614, 1772,
                1563, 1764,
                1526, 1747,
                1489, 1706,
                1445, 1672,
                1373, 1628,
                1312, 1603,
                1289, 1594,
                1068, 1594,
                984, 1604,
                906, 1636,
                849, 1674,
                796, 1718,
                769, 1754,
                730, 1770,
                703, 1775,
                662, 1760,
                607, 1736,
                540, 1729,
                483, 1741,
                462, 1751,
                421, 1763,
                367, 1783,
                339, 1770,
                316, 1755,
                292, 1719,
                271, 1674,
                271, 1609,
                287, 1554,
                285, 744,
                266, 704,
                253, 658,
                261, 626,
                288, 609,
                307, 581,
                314, 563,
                310, 538,
                284, 504,
                270, 463,
                264, 430,
                276, 403,
                283, 385,
                276, 348,
                276, 326,
                261, 307,
                261, 280,
                279, 260,
                312, 255,
                335, 268,
                349, 296,
                372, 297,
                398, 278,
                422, 274
            };
            int navOut[200] = {
                65, 119,
                79, 88,
                106, 69,
                860, 67,
                900, 76,
                950, 68,
                1940, 67,
                1970, 81,
                1981, 108,
                1981, 585,
                1942, 614,
                1915, 650,
                1900, 671,
                1514, 669,
                1468, 678,
                1431, 701,
                1407, 736,
                1407, 800,
                1389, 859,
                1362, 911,
                1325, 959,
                1276, 1000,
                1230, 1025,
                1175, 1046,
                1121, 1053,
                1052, 1052,
                987, 1039,
                931, 1016,
                887, 991,
                849, 956,
                818, 919,
                806, 877,
                806, 742,
                785, 696,
                748, 669,
                701, 668,
                663, 692,
                640, 731,
                636, 754,
                634, 1197,
                648, 1254,
                676, 1304,
                709, 1331,
                740, 1340,
                1356, 1341,
                1399, 1322,
                1425, 1292,
                1439, 1251,
                1440, 1169,
                1428, 1130,
                1426, 1096,
                1426, 1048,
                1440, 989,
                1441, 882,
                1460, 844,
                1489, 818,
                1537, 815,
                1582, 806,
                1603, 792,
                1663, 794,
                1710, 796,
                1757, 800,
                1786, 812,
                1838, 813,
                1879, 796,
                1919, 803,
                1956, 822,
                1984, 872,
                2001, 929,
                1994, 987,
                1985, 1019,
                1981, 1862,
                1947, 1889,
                1946, 1925,
                1914, 1962,
                1889, 1984,
                1412, 1980,
                1375, 1960,
                1324, 1907,
                1274, 1862,
                1216, 1829,
                1151, 1815,
                1084, 1815,
                1028, 1832,
                974, 1862,
                941, 1902,
                913, 1946,
                861, 1979,
                677, 1979,
                645, 1961,
                566, 1955,
                479, 1953,
                425, 1961,
                398, 1974,
                366, 1976,
                332, 1981,
                140, 1979,
                96, 1948,
                67, 1915,
                67, 136
            };

            totalCars = 9;
            carsBasePath = "Assets/Maps/River/Cars/";
			boundsIn = bIn;
			boundsInSize = 260;
            boundsInReverse = true;
			boundsOut = bOut;
			boundsOutSize = 186;
            boundsOutReverse = false;
			navigationLayerIn = navIn;
			navigationLayerInSize = 310;
            navInReverse = false;
			navigationLayerOut = navOut;
			navigationLayerOutSize = 200;
            navOutReverse = true;
			mapImg = "Assets/Maps/River/MapaRacing1.png";
			mapTmx = "Assets/Maps/River/Map1.tmx";
			boxTex = "Assets/Maps/River/boxObstacle.png";
			circleTex = "Assets/Maps/River/circleObstacle.png";
		}
        else if (mapNumber == 2) 
        {
            int bIn[300] = {
                1580, 1559,
                428, 1560,
                397, 1464,
                388, 1392,
                378, 1283,
                394, 1261,
                373, 1197,
                402, 1094,
                416, 1067,
                408, 1041,
                395, 1030,
                374, 901,
                397, 860,
                419, 846,
                422, 813,
                420, 759,
                400, 692,
                406, 628,
                377, 519,
                400, 445,
                415, 397,
                469, 363,
                544, 366,
                603, 363,
                664, 373,
                750, 381,
                824, 383,
                1004, 394,
                1031, 403,
                1153, 389,
                1222, 378,
                1263, 353,
                1281, 352,
                1328, 382,
                1398, 381,
                1450, 378,
                1472, 396,
                1504, 387,
                1579, 378,
                1634, 347,
                1693, 347,
                1714, 386,
                1720, 511,
                1693, 612,
                1691, 643,
                1711, 726,
                1692, 775,
                1725, 885,
                1741, 892,
                1752, 882,
                1755, 863,
                1740, 834,
                1747, 709,
                1740, 629,
                1747, 563,
                1743, 498,
                1738, 371,
                1703, 321,
                1638, 316,
                1554, 292,
                1532, 294,
                1463, 302,
                1400, 301,
                1324, 311,
                1312, 288,
                1303, 273,
                1287, 265,
                1266, 270,
                1212, 300,
                1127, 298,
                1027, 310,
                960, 295,
                923, 329,
                801, 326,
                774, 298,
                748, 287,
                697, 283,
                651, 294,
                601, 312,
                560, 322,
                540, 280,
                527, 272,
                512, 279,
                496, 308,
                465, 288,
                327, 300,
                306, 312,
                302, 330,
                309, 372,
                317, 468,
                353, 536,
                336, 601,
                318, 640,
                318, 663,
                304, 693,
                305, 713,
                335, 743,
                334, 821,
                307, 871,
                309, 886,
                359, 914,
                373, 999,
                326, 1070,
                328, 1088,
                334, 1153,
                327, 1206,
                323, 1224,
                286, 1285,
                272, 1299,
                273, 1314,
                276, 1351,
                271, 1369,
                283, 1382,
                312, 1408,
                305, 1480,
                309, 1500,
                310, 1545,
                298, 1563,
                307, 1583,
                325, 1627,
                307, 1680,
                300, 1699,
                304, 1718,
                319, 1725,
                335, 1716,
                396, 1722,
                411, 1720,
                419, 1708,
                396, 1667,
                419, 1618,
                429, 1591,
                1578, 1592,
                1601, 1597,
                1612, 1652,
                1598, 1732,
                1603, 1750,
                1631, 1751,
                1646, 1733,
                1682, 1723,
                1702, 1728,
                1731, 1740,
                1744, 1727,
                1750, 1656,
                1744, 1641,
                1726, 1611,
                1727, 1590,
                1714, 1573,
                1694, 1572,
                1614, 1571,
                1588, 1560
            };
            int bOut[78] = {
                18, 18,
                1878, 17,
                1919, 33,
                2000, 95,
                2015, 139,
                2000, 175,
                2001, 193,
                2031, 235,
                2032, 1262,
                1555, 1262,
                1497, 1250,
                1428, 1146,
                1428, 1038,
                1432, 882,
                1446, 846,
                1378, 754,
                1362, 748,
                1322, 760,
                754, 761,
                754, 792,
                1322, 791,
                1397, 879,
                1359, 1029,
                1374, 1294,
                1396, 1308,
                1422, 1307,
                1555, 1293,
                2030, 1294,
                2032, 2029,
                276, 2029,
                257, 2002,
                182, 1997,
                126, 2012,
                82, 2011,
                47, 1990,
                29, 1940,
                60, 1874,
                17, 1855,
                17, 26
            };
            int navIn[410] = {
                319, 286,
                508, 286,
                519, 274,
                532, 271,
                541, 277,
                545, 285,
                564, 297,
                577, 304,
                601, 304,
                635, 299,
                684, 288,
                692, 280,
                703, 281,
                709, 286,
                1251, 285,
                1260, 272,
                1274, 262,
                1292, 262,
                1306, 270,
                1314, 286,
                1718, 287,
                1733, 282,
                1744, 278,
                1751, 282,
                1764, 282,
                1776, 289,
                1777, 296,
                1782, 306,
                1778, 319,
                1777, 336,
                1766, 368,
                1762, 394,
                1762, 982,
                1749, 995,
                1732, 999,
                1720, 1002,
                1702, 999,
                1688, 986,
                1681, 973,
                1682, 448,
                1661, 433,
                1653, 424,
                1647, 424,
                1626, 408,
                1578, 406,
                1547, 412,
                1537, 409,
                1494, 412,
                1448, 411,
                1406, 415,
                1380, 417,
                1344, 424,
                1311, 433,
                1282, 446,
                1249, 464,
                1215, 488,
                1188, 508,
                1174, 514,
                1158, 517,
                1148, 524,
                1088, 524,
                1059, 515,
                1046, 516,
                1030, 514,
                1022, 505,
                1012, 498,
                1004, 489,
                992, 464,
                974, 452,
                944, 435,
                900, 419,
                849, 406,
                742, 406,
                732, 410,
                709, 412,
                678, 411,
                650, 408,
                625, 406,
                618, 408,
                582, 411,
                554, 424,
                528, 439,
                509, 448,
                488, 456,
                475, 458,
                460, 466,
                448, 480,
                440, 496,
                433, 514,
                433, 1268,
                426, 1282,
                424, 1300,
                416, 1307,
                416, 1322,
                412, 1332,
                409, 1340,
                416, 1347,
                426, 1356,
                433, 1390,
                433, 1488,
                446, 1508,
                462, 1526,
                478, 1536,
                505, 1544,
                516, 1545,
                534, 1552,
                1712, 1553,
                1721, 1547,
                1757, 1547,
                1766, 1552,
                1770, 1563,
                1770, 1574,
                1774, 1588,
                1774, 1601,
                1766, 1614,
                1762, 1626,
                1761, 1740,
                1766, 1746,
                1764, 1778,
                1760, 1788,
                1747, 1794,
                1708, 1794,
                1700, 1796,
                1688, 1791,
                1622, 1786,
                1611, 1787,
                1596, 1784,
                1581, 1783,
                1576, 1776,
                1567, 1772,
                1548, 1750,
                1535, 1722,
                1516, 1692,
                1496, 1669,
                1472, 1651,
                1447, 1634,
                1417, 1624,
                1391, 1618,
                1234, 1618,
                1210, 1622,
                1178, 1636,
                1150, 1653,
                1132, 1670,
                1130, 1679,
                1123, 1686,
                1094, 1710,
                1079, 1729,
                1070, 1740,
                1048, 1746,
                1023, 1746,
                1000, 1734,
                983, 1729,
                974, 1718,
                962, 1712,
                952, 1702,
                933, 1683,
                915, 1671,
                886, 1664,
                875, 1661,
                540, 1662,
                515, 1668,
                508, 1674,
                497, 1671,
                484, 1672,
                459, 1684,
                440, 1696,
                435, 1708,
                439, 1720,
                440, 1732,
                439, 1759,
                432, 1765,
                416, 1767,
                400, 1762,
                317, 1761,
                305, 1764,
                296, 1768,
                286, 1764,
                280, 1750,
                282, 1737,
                286, 1722,
                286, 1390,
                275, 1378,
                266, 1369,
                270, 1360,
                276, 1351,
                274, 1336,
                274, 1322,
                268, 1310,
                267, 1298,
                275, 1288,
                286, 1280,
                286, 1162,
                283, 1144,
                278, 1128,
                276, 1108,
                270, 1089,
                273, 1062,
                286, 1009,
                286, 326,
                283, 317,
                281, 309,
                281, 290,
                288, 282,
                298, 280,
                313, 285
            };
            int navOut[328] = {
                66, 168,
                218, 67,
                1866, 65,
                1877, 72,
                1894, 76,
                1909, 81,
                1923, 80,
                1934, 75,
                1966, 93,
                1974, 114,
                1975, 130,
                1982, 163,
                1982, 1131,
                1972, 1158,
                1939, 1191,
                1918, 1200,
                1898, 1213,
                1874, 1222,
                1841, 1221,
                1816, 1223,
                1797, 1227,
                1615, 1227,
                1600, 1223,
                1589, 1218,
                1563, 1212,
                1537, 1199,
                1507, 1170,
                1495, 1140,
                1482, 1119,
                1470, 1102,
                1462, 1090,
                1461, 661,
                1469, 645,
                1469, 629,
                1457, 621,
                1432, 621,
                1424, 625,
                1387, 625,
                1371, 630,
                1361, 640,
                1352, 648,
                1341, 654,
                1332, 661,
                1312, 669,
                1287, 674,
                1265, 677,
                1253, 679,
                1246, 685,
                1232, 686,
                1213, 692,
                1184, 693,
                1155, 700,
                1128, 701,
                1120, 704,
                1095, 705,
                1072, 712,
                1063, 710,
                1024, 708,
                983, 700,
                948, 689,
                923, 676,
                915, 667,
                904, 652,
                896, 636,
                874, 620,
                847, 606,
                816, 604,
                789, 611,
                766, 626,
                727, 626,
                704, 613,
                660, 612,
                637, 625,
                629, 637,
                635, 651,
                646, 659,
                647, 668,
                653, 673,
                653, 743,
                645, 760,
                639, 783,
                640, 800,
                648, 823,
                659, 836,
                668, 841,
                689, 839,
                715, 832,
                732, 828,
                753, 828,
                757, 826,
                1284, 826,
                1298, 836,
                1315, 849,
                1321, 864,
                1330, 876,
                1339, 885,
                1339, 1289,
                1336, 1308,
                1333, 1326,
                1338, 1338,
                1344, 1343,
                1356, 1340,
                1374, 1336,
                1384, 1332,
                1917, 1334,
                1933, 1341,
                1940, 1349,
                1944, 1366,
                1952, 1388,
                1967, 1409,
                1975, 1427,
                1981, 1449,
                1981, 1880,
                1970, 1918,
                1960, 1942,
                1943, 1967,
                1923, 1982,
                1575, 1981,
                1531, 1960,
                1489, 1928,
                1456, 1903,
                1424, 1885,
                1407, 1872,
                1395, 1860,
                1377, 1850,
                1358, 1844,
                1344, 1844,
                1324, 1837,
                1308, 1831,
                1248, 1829,
                1230, 1840,
                1216, 1858,
                1200, 1868,
                1180, 1890,
                1157, 1919,
                1112, 1944,
                1060, 1953,
                888, 1954,
                853, 1934,
                825, 1914,
                777, 1886,
                758, 1874,
                710, 1868,
                677, 1868,
                638, 1877,
                603, 1889,
                560, 1912,
                461, 1964,
                424, 1980,
                287, 1980,
                117, 1981,
                101, 1971,
                96, 1949,
                88, 1931,
                76, 1913,
                66, 1889,
                65, 700,
                75, 671,
                77, 643,
                76, 616,
                72, 604,
                72, 448,
                66, 415,
                65, 178
            };

            totalCars = 9;
            carsBasePath = "Assets/Maps/Sea Floor/Cars/";
            boundsIn = bIn;
            boundsInSize = 300;
            boundsInReverse = true;
            boundsOut = bOut;
            boundsOutSize = 78;
            boundsOutReverse = true;
            navigationLayerIn = navIn;
            navigationLayerInSize = 410;
            navInReverse = false;
            navigationLayerOut = navOut;
            navigationLayerOutSize = 328;
            navOutReverse = false;
            mapImg = "Assets/Maps/Sea Floor/MapaRacing2.png";
            mapTmx = "Assets/Maps/Sea Floor/Map2.tmx";
            boxTex = "Assets/Maps/Sea Floor/boxObstacle.png";
            circleTex = "Assets/Maps/Sea Floor/circleObstacle.png";
        }
		else if (mapNumber == 3) 
		{
			int bIn[34] = {
				477, 480,
				477, 2505,
				1017, 2514,
				1020, 2017,
				1977, 2020,
				1977, 2514,
				2514, 2520,
				2517, 1980,
				1020, 1977,
				1022, 1020,
				2520, 1017,
				2520, 480,
				2482, 482,
				2477, 977,
				1020, 980,
				1020, 482,
				491, 477
			};
			int bOut[32] = {
				1492, 20,
				16, 24,
				20, 2976,
				1480, 2975,
				1484, 2484,
				1520, 2485,
				1522, 2980,
				2977, 2977,
				2976, 1523,
				1523, 1520,
				1523, 1480,
				2976, 1480,
				2976, 26,
				2026, 26,
				2020, 520,
				1473, 523
			};
			int navIn[84] = {
				368, 2492,
				368, 504,
				420, 416,
				500, 380,
				1000, 376,
				1080, 408,
				1132, 504,
				1200, 700,
				1312, 808,
				1472, 860,
				2028, 864,
				2216, 796,
				2312, 676,
				2380, 440,
				2492, 368,
				2588, 416,
				2624, 508,
				2620, 996,
				2576, 1084,
				2484, 1128,
				1484, 1124,
				1196, 1276,
				1120, 1512,
				1288, 1796,
				1540, 1872,
				2500, 1872,
				2580, 1916,
				2620, 1996,
				2620, 2484,
				2584, 2576,
				2472, 2620,
				1988, 2612,
				1904, 2568,
				1852, 2460,
				1696, 2184,
				1488, 2128,
				1280, 2196,
				1124, 2488,
				1084, 2584,
				996, 2620,
				496, 2620,
				412, 2568
			};
			int navOut[96] = {
				217, 262,
				495, 127,
				1020, 140,
				1240, 217,
				1372, 502,
				1427, 597,
				1502, 625,
				2000, 622,
				2077, 585,
				2120, 497,
				2196, 288,
				2480, 136,
				2716, 196,
				2828, 340,
				2868, 552,
				2864, 1020,
				2804, 1212,
				2672, 1320,
				2488, 1364,
				1504, 1368,
				1384, 1436,
				1368, 1512,
				1420, 1584,
				1504, 1624,
				2500, 1624,
				2704, 1696,
				2816, 1824,
				2860, 1972,
				2864, 2500,
				2800, 2708,
				2692, 2812,
				2528, 2860,
				1964, 2864,
				1792, 2808,
				1680, 2676,
				1624, 2476,
				1556, 2384,
				1452, 2372,
				1380, 2448,
				1360, 2576,
				1296, 2708,
				1128, 2836,
				1020, 2860,
				476, 2860,
				276, 2788,
				168, 2640,
				128, 2500,
				132, 480
			};

            totalCars = 4;
            carsBasePath = "Assets/Maps/Road/Cars/";
			boundsIn = bIn;
			boundsInSize = 34;
            boundsInReverse = true;
			boundsOut = bOut;
			boundsOutSize = 32;
            boundsOutReverse = false;
			navigationLayerIn = navIn;
			navigationLayerInSize = 84;
            navInReverse = false;
			navigationLayerOut = navOut;
			navigationLayerOutSize = 96;
            navOutReverse = true;
			mapImg = "Assets/Maps/Road/road.png";
			mapTmx = "Assets/Maps/Road/road.tmx";
			boxTex = "Assets/Maps/Road/boxObstacle.png";
			circleTex = "Assets/Maps/Road/circleObstacle.png";
		}

		Map* map = new Map(app, 0, 0, 0, totalCars, carsBasePath, boundsIn, boundsInSize, boundsInReverse, boundsOut, boundsOutSize, boundsOutReverse, navigationLayerIn, navigationLayerInSize, navInReverse, navigationLayerOut, navigationLayerOutSize, navOutReverse, listener, LoadTexture(mapImg));
		MapData data = GetMapData(mapTmx, app, listener, boxTex, circleTex);

		std::sort(data.startPositions.begin(), data.startPositions.end(),
			[](const std::pair<Transform2D, int>& a, const std::pair<Transform2D, int>& b) {
				return a.second < b.second;
			});

		for (auto& p : data.startPositions) map->addStartPosition(p.first);
		for (auto& c : data.checkpoints) map->addCheckPoint(c);
		for (auto& o : data.obstacles) map->addObstacle(o);
        for (auto& z : data.slowZones) map->addSlowZone(z);
        for (auto& b : data.booster) map->addBooster(b);
		map->addFinishLine(data.finishline);
		return map;
	}

	static MapData GetMapData(const char* mapPath, Application* app, Module* listener, const char* boxTex, const char* circleTex) {
		MapData data;

		pugi::xml_document mapFileXML;
		pugi::xml_parse_result result = mapFileXML.load_file(mapPath);

		data.width = mapFileXML.child("map").attribute("width").as_int();
		data.height = mapFileXML.child("map").attribute("height").as_int();

		for (pugi::xml_node objectGroupNode = mapFileXML.child("map").child("objectgroup"); objectGroupNode != NULL; objectGroupNode = objectGroupNode.next_sibling("objectgroup")) {

			std::string name = objectGroupNode.attribute("name").as_string();

			for (pugi::xml_node objectNode = objectGroupNode.child("object"); objectNode != NULL; objectNode = objectNode.next_sibling("object")) {
				int x = objectNode.attribute("x").as_int();
				int y = objectNode.attribute("y").as_int();
				int width = objectNode.attribute("width").as_int();
				int height = objectNode.attribute("height").as_int();
				float rot = objectNode.attribute("rotation").as_float();

				float halfW = width / 2.f;
				float halfH = height / 2.f;
				float centerX = x + halfW;
				float centerY = y + halfH;

				float newX = centerX;
				float newY = centerY;

				if (rot != 0) {
					float r = rot * (PI / 180.f);
					newX = x + halfW * cos(r) - halfH * sin(r);
					newY = y + halfW * sin(r) + halfH * cos(r);
				}

				if (name == "StartPositions")
				{
					int order = objectNode.child("properties").child("property").attribute("value").as_int();
					Transform2D t(newX, newY, rot);
					data.startPositions.push_back(std::make_pair(t, order));
				}
				else if (name == "SlowZones")
				{
					float scale = objectNode.child("properties").child("property").attribute("value").as_float();
					SlowZone* z = new SlowZone(app, newX, newY, width, height, rot, listener, scale);
					data.slowZones.push_back(z);
				}
                else if (name == "Boosters")
                {
                    float scale = 0;
                    float time = 0;

                    for (pugi::xml_node propNode = objectNode.child("properties").child("property"); propNode != NULL; propNode = propNode.next_sibling("property")) {
                        std::string prop = propNode.attribute("name").as_string();
                        float val = propNode.attribute("value").as_float();
                        if (prop == "scale") scale = val;
                        if (prop == "time") time = val;
                    }

                    Booster* b = new Booster(app, newX, newY, width, height, rot, listener, scale, time);
                    data.booster.push_back(b);
                }
				else if (name == "Obstacles")
				{
					std::string type = "";
					float restitution = 0;
					
					for (pugi::xml_node propNode = objectNode.child("properties").child("property"); propNode != NULL; propNode = propNode.next_sibling("property")) {
						std::string prop = propNode.attribute("name").as_string();
						pugi::xml_attribute valAttr = propNode.attribute("value");
						if (prop == "type") type = valAttr.as_string();
						if (prop == "restitution") restitution = valAttr.as_float();
					}
					
					PhysicEntity* o = nullptr;
					if (type == "box") o = new Box(app->physics, app->renderer, newX, newY, listener, LoadTexture(boxTex), EntityType::OBSTACLE, rot, false, restitution);
					else if (type == "circle") o = new Circle(app->physics, app->renderer, newX, newY, listener, LoadTexture(circleTex), EntityType::OBSTACLE, rot, false, restitution);
					
					if (o) data.obstacles.push_back(o);
				}
				else if (name == "Checkpoints")
				{
					int order = objectNode.child("properties").child("property").attribute("value").as_int();
					Checkpoint* c = new Checkpoint(app, newX, newY, width, height, rot, listener, order);
					data.checkpoints.push_back(c);
				}
				else if (name == "Finishline")
				{
					data.finishline = new Finishline(app, newX, newY, width, height, rot, listener);
				}
			}
		}
		
		return data;
	}
};